<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Generador de QR para Cotizaciones</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
  
    .share-panel {
      display: none;
      margin-top: 25px;
      background: var(--blanco);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 350px;
      border: 2px solid var(--verde);
      animation: fadeIn 0.3s ease-out;
    }
    
    .share-panel h3 {
      color: var(--morado);
      text-align: center;
      margin-bottom: 20px;
      font-size: 18px;
    }
    
    .share-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
    }
    
    .share-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 80px;
      height: 80px;
      border-radius: 12px;
      border: none;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
      font-weight: 600;
      text-decoration: none;
    }
    
    .share-btn i {
      font-size: 24px;
      margin-bottom: 8px;
    }
    
    .share-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .share-btn:active {
      transform: translateY(0);
    }
    
    .whatsapp { background-color: #25D366; }
    .email { background-color: #EA4335; }
    .sms { background-color: #34B7F1; }
    .copy { background-color: #733298; }
    .download { background-color: #44ABA8; }
    .telegram { background-color: #0088cc; }
    
    .share-link {
      margin-top: 20px;
      display: flex;
      gap: 10px;
    }
    
    .share-link input {
      flex: 1;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
    }
    
    .share-link button {
      background-color: var(--verde);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }
    
    .close-share {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 20px;
      color: #666;
      cursor: pointer;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }
    
    .close-share:hover {
      background-color: #f0f0f0;
    }
    
    .qr-actions {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
    }
    
    .qr-actions button {
      width: auto;
      padding: 10px 20px;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-share {
      background-color: var(--azul);
    }
    
    .btn-share:hover {
      background-color: #3a9c99;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Notificaci贸n flotante */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--verde-exito);
      color: white;
      padding: 15px 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      display: none;
      z-index: 1000;
      animation: slideIn 0.3s ease-out;
    }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    .notification.error {
      background: var(--rojo);
    }
  </style>
</head>
<body>
  <!-- Notificaci贸n flotante -->
  <div id="notification" class="notification"></div>
  
  <h1>Generar QR de Cotizaci贸n</h1>
  
  <div class="form-container">
    <!-- Campo: Nombre del vendedor -->
    <label for="nombre" class="requerido"> Nombre del vendedor:</label>
    <select id="nombre" required>
      <option value="">Selecciona un vendedor</option>
      <option value="Luis Alfonso">Luis Alfonso</option>
      <option value="Victor Hugo">Victor Hugo</option>
      <option value="C茅sar Guzm谩n">C茅sar Guzm谩n</option>
      <option value="Pedro Mese帽o">Pedro Mese帽o</option>
      <option value="David Mancilla">David Mancilla</option>
      <option value="Vanessa Guevara">Vanessa Guevara</option>
      <option value="Alex vila">Alex vila</option>
      <option value="Motumex Naucalpan">Motumex Naucalpan</option>
      <option value="Verificentros">Verificentros</option>
    </select>

    <!-- Campo: Tipo de movimiento -->
    <label for="movimiento" class="requerido"> Tipo de movimiento:</label>
    <select id="movimiento" required>
      <option value="">Selecciona un tipo</option>
      <option value="Convertidor catal铆tico">Convertidor catal铆tico</option>
      <option value="Convertidor + rechazo">Convertidor + rechazo</option>
      <option value="Holograma(0)">Holograma(0)</option>
    </select>

    <!-- Campo: Veh铆culo -->
    <label for="vehiculo" class="requerido"> Veh铆culo:</label>
    <input type="text" id="vehiculo" placeholder="Ej: Nissan Sentra 2020" required>

    <!-- Campo: Costo -->
    <label for="costo" class="requerido"> Costo:</label>
    <input type="number" id="costo" placeholder="Ej. 1500" min="0" step="0.01" required>

    <button onclick="generarQR()">
      <i class="fas fa-qrcode"></i> Generar QR
    </button>
    
    <div class="texto-centro" style="margin-top: 15px;">
      <button onclick="copiarEnlace()" class="btn-copiar">
        <i class="fas fa-copy"></i> Copiar Enlace
      </button>
    </div>
  </div>

  <!-- Tarjeta donde aparecer谩 el QR -->
  <div id="qrCard" class="qr-card" style="display:none;">
    <h2>Tu c贸digo QR</h2>
    <div id="qrContainer"></div>
    <p>Escanea este c贸digo con un tel茅fono para registrar la cotizaci贸n</p>
    
    <div class="qr-actions">
      <button onclick="mostrarPanelCompartir()" class="btn-share">
        <i class="fas fa-share-alt"></i> Compartir
      </button>
      <button onclick="descargarQR()" style="background-color: var(--verde);">
        <i class="fas fa-download"></i> Descargar
      </button>
    </div>
  </div>

  <!-- Panel de compartir -->
  <div id="sharePanel" class="share-panel">
    <button class="close-share" onclick="ocultarPanelCompartir()">
      <i class="fas fa-times"></i>
    </button>
    <h3>Compartir Cotizaci贸n</h3>
    
    <div class="share-buttons">
      <button class="share-btn whatsapp" onclick="compartirWhatsApp()">
        <i class="fab fa-whatsapp"></i>
        <span>WhatsApp</span>
      </button>
      
      <button class="share-btn email" onclick="compartirCorreo()">
        <i class="fas fa-envelope"></i>
        <span>Correo</span>
      </button>
      
      <button class="share-btn telegram" onclick="compartirTelegram()">
        <i class="fab fa-telegram"></i>
        <span>Telegram</span>
      </button>
      
      <button class="share-btn sms" onclick="compartirSMS()">
        <i class="fas fa-sms"></i>
        <span>SMS</span>
      </button>
      
      <button class="share-btn copy" onclick="copiarEnlace()">
        <i class="fas fa-copy"></i>
        <span>Copiar</span>
      </button>
      
      <button class="share-btn download" onclick="descargarQR()">
        <i class="fas fa-download"></i>
        <span>Descargar</span>
      </button>
    </div>
    
    <div class="share-link">
      <input type="text" id="shareLink" readonly placeholder="Enlace de la cotizaci贸n">
      <button onclick="copiarEnlaceInput()">
        <i class="fas fa-copy"></i>
      </button>
    </div>
  </div>

  <!-- Librer铆a QRCodeStyling -->
  <script src="https://cdn.jsdelivr.net/npm/qr-code-styling@1.5.0/lib/qr-code-styling.min.js"></script>
  <script src="js/script.js"></script>
  
  <script>
    // Variables globales
    let enlaceGenerado = '';
    let qrInstance = null;
    
    // Funci贸n para mostrar notificaci贸n
    function mostrarNotificacion(mensaje, tipo = 'success') {
      const notification = document.getElementById('notification');
      notification.textContent = mensaje;
      notification.className = 'notification';
      
      if (tipo === 'error') {
        notification.classList.add('error');
      }
      
      notification.style.display = 'block';
      
      setTimeout(() => {
        notification.style.display = 'none';
      }, 3000);
    }
    
    // Funci贸n para mostrar panel de compartir
    function mostrarPanelCompartir() {
      if (!enlaceGenerado) {
        mostrarNotificacion('Primero genera un QR', 'error');
        return;
      }
      
      document.getElementById('sharePanel').style.display = 'block';
      document.getElementById('shareLink').value = enlaceGenerado;
    }
    
    // Funci贸n para ocultar panel de compartir
    function ocultarPanelCompartir() {
      document.getElementById('sharePanel').style.display = 'none';
    }
    
    // Funci贸n para compartir por WhatsApp
    function compartirWhatsApp() {
      if (!enlaceGenerado) return;
      
      const nombre = document.getElementById('nombre').value;
      const movimiento = document.getElementById('movimiento').value;
      const vehiculo = document.getElementById('vehiculo').value;
      const costo = document.getElementById('costo').value;
      
      const mensaje = 
                     `Presenta este c贸digo al llegar:\n` +
                     `${enlaceGenerado}`;
      
      const url = `https://wa.me/?text=${encodeURIComponent(mensaje)}`;
      window.open(url, '_blank');
      mostrarNotificacion('WhatsApp abierto para compartir');
    }
    
    // Funci贸n para compartir por correo
    function compartirCorreo() {
      if (!enlaceGenerado) return;
      
      const nombre = document.getElementById('nombre').value;
      const movimiento = document.getElementById('movimiento').value;
      const vehiculo = document.getElementById('vehiculo').value;
      const costo = document.getElementById('costo').value;
      
      const asunto = `Cotizaci贸n: ${movimiento} - ${vehiculo}`;
      const cuerpo = `Para registrar esta cotizaci贸n, accede al siguiente enlace:\n` +
                    `${enlaceGenerado}\n\n` +
                    `O escanea el c贸digo QR adjunto.`;
      
      const url = `mailto:?subject=${encodeURIComponent(asunto)}&body=${encodeURIComponent(cuerpo)}`;
      window.location.href = url;
      mostrarNotificacion('Cliente de correo abierto');
    }
    
    // Funci贸n para compartir por Telegram
    function compartirTelegram() {
      if (!enlaceGenerado) return;
      
      const nombre = document.getElementById('nombre').value;
      const movimiento = document.getElementById('movimiento').value;
      const vehiculo = document.getElementById('vehiculo').value;
      const costo = document.getElementById('costo').value;
      
      const mensaje = `Enlace para registrar: ${enlaceGenerado}`;
      
      const url = `https://t.me/share/url?url=${encodeURIComponent(enlaceGenerado)}&text=${encodeURIComponent(mensaje)}`;
      window.open(url, '_blank');
      mostrarNotificacion('Telegram abierto para compartir');
    }
    
    // Funci贸n para descargar QR
    function descargarQR() {
      if (!qrInstance) {
        mostrarNotificacion('Primero genera un QR', 'error');
        return;
      }
      
      const nombre = document.getElementById('nombre').value.replace(/\s+/g, '_');
      const movimiento = document.getElementById('movimiento').value.replace(/\s+/g, '_');
      const vehiculo = document.getElementById('vehiculo').value.replace(/\s+/g, '_');
      
      const nombreArchivo = `QR_Cotizacion_${nombre}_${movimiento}_${vehiculo}.png`;
      
      qrInstance.download({
        name: nombreArchivo,
        extension: "png"
      }).then(() => {
        mostrarNotificacion('QR descargado correctamente');
      }).catch(error => {
        console.error('Error al descargar:', error);
        mostrarNotificacion('Error al descargar', 'error');
      });
    }
    
    // Funci贸n para copiar enlace desde input
    function copiarEnlaceInput() {
      const input = document.getElementById('shareLink');
      input.select();
      input.setSelectionRange(0, 99999); // Para m贸viles
      
      try {
        navigator.clipboard.writeText(input.value)
          .then(() => {
            mostrarNotificacion('Enlace copiado al portapapeles');
            input.blur();
          })
          .catch(err => {
            // M茅todo alternativo para navegadores m谩s antiguos
            document.execCommand('copy');
            mostrarNotificacion('Enlace copiado');
            input.blur();
          });
      } catch (err) {
        mostrarNotificacion('No se pudo copiar', 'error');
      }
    }
    
    // Sobreescribir funci贸n generarQR para actualizar enlaceGenerado
    const originalGenerarQR = window.generarQR;
    window.generarQR = function() {
      originalGenerarQR();
      
      // Actualizar enlace generado
      const nombre = encodeURIComponent(document.getElementById("nombre").value);
      const movimiento = encodeURIComponent(document.getElementById("movimiento").value);
      const vehiculo = encodeURIComponent(document.getElementById("vehiculo").value);
      const costo = encodeURIComponent(document.getElementById("costo").value);
      
      enlaceGenerado = `https://frikmans.github.io/generador-qr2/formulario-datos.html?nombre=${nombre}&movimiento=${movimiento}&vehiculo=${vehiculo}&costo=${costo}&token=U2VydmljaW9QYXJhUGF0eQ==`;
      
      // Guardar instancia QR para descarga
      setTimeout(() => {
        qrInstance = window.qr;
      }, 100);
    };
    
    // Sobreescribir funci贸n copiarEnlace
    const originalCopiarEnlace = window.copiarEnlace;
    window.copiarEnlace = function() {
      if (!enlaceGenerado) {
        mostrarNotificacion('Primero genera un QR', 'error');
        return;
      }
      
      try {
        navigator.clipboard.writeText(enlaceGenerado)
          .then(() => {
            mostrarNotificacion('Enlace copiado al portapapeles');
          })
          .catch(err => {
            // M茅todo alternativo
            const textArea = document.createElement('textarea');
            textArea.value = enlaceGenerado;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            mostrarNotificacion('Enlace copiado');
          });
      } catch (err) {
        mostrarNotificacion('No se pudo copiar', 'error');
      }
    };
    
    // Cerrar panel al hacer clic fuera
    document.addEventListener('click', function(event) {
      const sharePanel = document.getElementById('sharePanel');
      const qrCard = document.getElementById('qrCard');
      
      if (sharePanel.style.display === 'block' && 
          !sharePanel.contains(event.target) && 
          !event.target.closest('.btn-share') &&
          !qrCard.contains(event.target)) {
        ocultarPanelCompartir();
      }
    });
    
    // Cerrar con tecla ESC
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        ocultarPanelCompartir();
      }
    });
  </script>
</body>
</html>